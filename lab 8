CREATE PROCEDURE SP_THEM_CAPNHAT_NHANVIEN_BOA (
	@MANV NCHAR(10),
	@TENNV NVARCHAR(20),
	@GIOITINH NCHAR(10),
	@DIACHI NVARCHAR(30),
	@SODT NVARCHAR(20),
	@EMAIL NVARCHAR(30),
	@PHONG NVARCHAR(30),
	@FLAG BIT
)
AS
BEGIN
	IF @GIOITINH NOT IN ('NAM', 'NỮ')
	BEGIN
		SELECT 1 AS [MaLoi]
		RETURN
	END	
	IF @FLAG = 0
	BEGIN
		INSERT INTO NHANVIEN (MANV, TENNV, GIOITINH, DIACHI, SDT, EMAIL, PHONG)
		VALUES (@MANV, @TENNV, @GIOITINH, @DIACHI, @SODT, @EMAIL, @PHONG)
	END
	ELSE
	BEGIN
		UPDATE NHANVIEN
		SET TENNV = @TENNV,
			GIOITINH = @GIOITINH,
			DIACHI = @DIACHI,
			SDT = @SODT,
			EMAIL = @EMAIL,
			PHONG = @PHONG
		WHERE MANV = @MANV
	END

	SELECT 0 AS [MaLoi]
END

EXECUTE SP_THEM_CAPNHAT_NHANVIEN_BOA N'NV01', N'NGUYỄN THỊ THU' , N'NỮ', N'HÀ NỘI',N'0982626521', N'THU@GMAIL.COM', N'KẾ TOÁN', 0
USE BAITHUCHANHSO1_2
GO

CREATE PROCEDURE SP_THEM_CAPNHAT_NHANVIEN_BOA (
	@MANV NCHAR(10),
	@TENNV NVARCHAR(20),
	@GIOITINH NCHAR(10),
	@DIACHI NVARCHAR(30),
	@SODT NVARCHAR(20),
	@EMAIL NVARCHAR(30),
	@PHONG NVARCHAR(30),
	@FLAG BIT
)
AS
BEGIN
	IF @GIOITINH NOT IN ('NAM', 'NỮ')
	BEGIN
		SELECT 1 AS [MaLoi]
		RETURN
	END	
	IF @FLAG = 0
	BEGIN
		INSERT INTO NHANVIEN (MANV, TENNV, GIOITINH, DIACHI, SDT, EMAIL, PHONG)
		VALUES (@MANV, @TENNV, @GIOITINH, @DIACHI, @SODT, @EMAIL, @PHONG)
	END
	ELSE
	BEGIN
		UPDATE NHANVIEN
		SET TENNV = @TENNV,
			GIOITINH = @GIOITINH,
			DIACHI = @DIACHI,
			SDT = @SODT,
			EMAIL = @EMAIL,
			PHONG = @PHONG
		WHERE MANV = @MANV
	END

	SELECT 0 AS [MaLoi]
END

EXECUTE SP_THEM_CAPNHAT_NHANVIEN_BOA N'NV04', N'NGUYỄN THỊ A' , N'NỮ', N'TPHCM',N'092626521', N'A@GMAIL.COM', N'KẾA TOÁN', 0
SELECT * FROM NHANVIEN

CREATE PROCEDURE sp_AddOrUpdateSanPham
    @MASP nchar(10),
    @TENHANG nvarchar(20),
    @TENSP nvarchar(20),
    @SOLUONG int,
    @MAUSAC nvarchar(2),
    @GIABAN money,
    @DONVITINH nchar(10),
    @MOTA nvarchar(max),
    @Flag bit
AS
BEGIN
    SET NOCOUNT ON;
    IF NOT EXISTS (SELECT MAHANGSX FROM HANGSX WHERE TENHANG = @TENHANG)
    BEGIN
        SELECT 1 AS ErrorCode, 'TENHANG does not exist in HANGSX' AS ErrorMessage
        RETURN;
    END
    IF @SOLUONG < 0
    BEGIN
        SELECT 2 AS ErrorCode, 'SOLUONG must be greater than or equal to 0' AS ErrorMessage
        RETURN;
    END
    IF @Flag = 0 
    BEGIN
        INSERT INTO SANPHAM (MASP, MAHANGSX, TENSP, SOLUONG, MAUSAC, GIABAN, DONVITINH, MOTA)
        VALUES (@MASP, (SELECT MAHANGSX FROM HANGSX WHERE TENHANG = @TENHANG), @TENSP, @SOLUONG, @MAUSAC, @GIABAN, @DONVITINH, @MOTA)
    END
    ELSE 
    BEGIN
        UPDATE SANPHAM
        SET MAHANGSX = (SELECT MAHANGSX FROM HANGSX WHERE TENHANG = @TENHANG), TENSP = @TENSP, SOLUONG = @SOLUONG, MAUSAC = @MAUSAC, GIABAN = @GIABAN, DONVITINH = @DONVITINH, MOTA = @MOTA
        WHERE MASP = @MASP
    END
    SELECT 0 AS ErrorCode, 'Success' AS ErrorMessage
END
EXEC sp_AddOrUpdateSanPham 'SP06', 'OPPO', 'F5 PLUS', 100, 'X','6000000', 'CHIẾC', 'HÀNG CẬN CAO CẤP', 0

    @MANV NCHAR(10)
AS
BEGIN
    IF NOT EXISTS(SELECT * FROM NHANVIEN WHERE MANV = @MANV)
    BEGIN
        RETURN 1
    END
    ELSE
    BEGIN
        BEGIN TRANSACTION
        BEGIN TRY
            DELETE FROM BANGNHAP WHERE MANV = @MANV
            DELETE FROM BANGXUAT WHERE MANV = @MANV
            DELETE FROM NHANVIEN WHERE MANV = @MANV
            COMMIT TRANSACTION
            RETURN 0
        END TRY
        BEGIN CATCH
            ROLLBACK TRANSACTION
            RETURN 1
        END CATCH
    END
END
EXECUTE XOA_NHANVIEN 'NV04'

    @MASP NCHAR(10)
AS
BEGIN
    IF NOT EXISTS(SELECT * FROM SANPHAM WHERE MASP = @MASP)
    BEGIN
        RETURN 1
    END
    ELSE
    BEGIN
        BEGIN TRANSACTION
        BEGIN TRY
            DELETE FROM BANGNHAP WHERE MASP = @MASP
            DELETE FROM BANGXUAT WHERE MASP = @MASP
            DELETE FROM SANPHAM WHERE MASP = @MASP
            COMMIT TRANSACTION
            RETURN 0
        END TRY
        BEGIN CATCH
            ROLLBACK TRANSACTION
            RETURN 1
        END CATCH
    END
END
EXECUTE XOA_SANPHAM'SP06'
